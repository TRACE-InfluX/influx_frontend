{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/worker.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","process","influencers","cache","sorted","JSON","parse","influencer","id","engagement","e","relevance","activity","a","length","weights","atob","slice","accumulator","pool","next","average_weights","reduce","new_weights","avg","account_weights","find","username","weight","sort","b","val","stringify","__webpack_exports__","addEventListener","f","ref","data","type","method","params","Promise","resolve","then","apply","reject","result","postMessage","catch","error","message","stack"],"mappings":"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","file":"89e8828480719ef768d1.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"fa38\");\n","export function process(influencers, cache) {\n\n  // Skip heavy processing if results are cached\n  if (cache) {\n    let sorted = []\n    let c = JSON.parse(cache)\n    for(let influencer of influencers) {\n      let id = influencer.id\n      influencer.engagement = c.e[id]\n      influencer.relevance  = c.r[id]\n      influencer.activity   = c.a[id]\n      sorted[c.s[id]] = influencer\n    }\n    return { influencers: sorted, cache }\n  }\n\n  let length = influencers.length\n\n  // Decode Weights from Base64 String to JSON object\n  for(let influencer of influencers) {\n    influencer.weights = JSON.parse(atob(influencer.weights.slice(2,-1)))\n  }\n\n  // The accumulator function does a value-inclusive set union on each weight file\n  let accumulator = (pool, next) => {\n    for(let key in next.weights) {\n      pool[key] = next.weights[key] + (pool[key] || 0)\n    }\n    return pool\n  }\n\n  // Applies the accumulator to each influencer, resulting in a combined set of all weights\n  let average_weights = influencers.reduce(accumulator,{})\n\n  // Subtract 1 to remove outliers, then divide by length to average across all influencers\n  for (let key in average_weights) {\n    average_weights[key] = (average_weights[key] - 1) / length\n  }\n\n  // After obtaining an \"average influencer\", each influencer is compared to the average\n  for(let influencer of influencers) {\n    let new_weights = {}\n\n    // A weighted proportional distance from average is calculated for each key \n    for(let key in influencer.weights) {\n      let avg = average_weights[key]\n      \n      // This check filters out the outliers\n      if (avg) {\n        \n        // Subtract to get a distance from average, then reverse the decrement before normalizing\n        new_weights[key] = (influencer.weights[key] - avg) / (avg + 1)\n\n        // Extra weight is added to hashtags since they represent more powerful information\n        if (key[0] == '#') {\n          new_weights[key] *= 5\n        }\n      }\n    }\n    influencer.weights = new_weights\n  }\n\n  // For now an account is taken from the list to use as a base\n  // Later this will be done through website analysis\n  let account_weights = influencers.find(i => i.username == '@serotoninplus').weights\n\n  // Relevance Calculation\n  // After trying a few things, a simple value set intersection seems to produce the best results\n  for(let influencer of influencers) {\n    influencer.relevance = 0\n\n    // This is done by summing up the values in each side's shared keys\n    for(let key in account_weights) {\n      let weight = influencer.weights[key]\n      if (weight) {\n        influencer.relevance += account_weights[key] + weight\n      }\n    }\n  }\n\n  cache = {e:{},r:{},a:{},s:{}}\n  // Sort and reweight engagement based on percentile\n  influencers.sort((a,b) => b.engagement - a.engagement)\n  for(let i = 0; i < length; ++i) {\n    let val = 100 * (length - i) / length\n    influencers[i].engagement  = val\n    cache.e[influencers[i].id] = val\n  }\n\n  // Sort and reweight relevance based on percentile\n  influencers.sort((a,b) => b.relevance - a.relevance)\n  for(let i = 0; i < length; ++i) {\n    let val = 100 * (length - i) / length\n    influencers[i].relevance   = val\n    cache.r[influencers[i].id] = val\n  }\n\n  // Sort and reweight activity based on percentile\n  influencers.sort((a,b) => b.activity - a.activity)\n  for(let i = 0; i < length; ++i) {\n    let val = 100 * (length - i) / length\n    influencers[i].activity    = val\n    cache.a[influencers[i].id] = val\n  }\n\n  // Final sort\n  influencers.sort((a,b) =>\n    b.activity + b.engagement + b.relevance \n  - a.activity - a.engagement - a.relevance)\n  for(let i = 0; i < length; ++i) {\n    cache.s[influencers[i].id] = i\n  }\n  cache = JSON.stringify(cache)\n\n  // We're done \\o/\n  return { influencers, cache }\n}\naddEventListener('message', function (e) {var ref = e.data;var type = ref.type;var method = ref.method;var id = ref.id;var params = ref.params;var f, p;if (type === 'RPC' && method) {if (f = __webpack_exports__[method]) {p = Promise.resolve().then(function () { return f.apply(__webpack_exports__, params); });} else {p = Promise.reject('No such method');}p.then(function (result) {postMessage({type: 'RPC',id: id,result: result});}).catch(function (e) {var error = {message: e};if (e.stack) {error.message = e.message;error.stack = e.stack;error.name = e.name;}postMessage({type: 'RPC',id: id,error: error});});}});postMessage({type: 'RPC',method: 'ready'});"],"sourceRoot":""}